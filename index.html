<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Fuck My Ex Coin ($FMEX)</title>
  <link rel="stylesheet" href="styles.css" />
  <link rel="icon" href="/favicon.png" type="image/png" />
</head>
<body>
    <style>
  .toast {
    position: fixed;
    bottom: 30px;
    left: 50%;
    transform: translateX(-50%);
    background: #222;
    color: #fff;
    padding: 12px 20px;
    border-radius: 6px;
    font-weight: bold;
    opacity: 0;
    transition: opacity 0.5s ease-in-out;
    z-index: 9999;
  }
  .toast.show {
    opacity: 1;
  }
</style>

<div id="toast" class="toast"></div>
<audio id="toast-sound" src="assets/beep1.mp3" preload="auto"></audio>
<audio id="bg-music" src="assets/song.mp3" preload="auto" loop></audio>

    <header class="header">
    <div class="logo">ğŸ’”</div>
    <div class="header-controls">
      <button id="theme-toggle">ğŸŒ™</button>
      <button id="music-toggle" title="Toggle Music">ğŸµ</button>
      <button id="wallet-button">Connect Wallet</button>
    </div>
  </header>

  <div class="container">
    <header>
      <h1>ğŸ’”Fuck My Ex Token ($FMEX)</h1>
      <p>The only coin born from heartbreak, caffeine, and dangerously poor decisions.</p>
    </header>

    <section class="cards">
      <div class="card">
        <div class="icon">ğŸ˜ˆ</div>
        <h2>What is $FMEX?</h2>
        <p>$FMEX is your on-chain revenge. Itâ€™s not just a token â€” itâ€™s therapy on the blockchain.</p>
        <a class="whitepaper-button" href="https://drive.google.com/file/d/1nzgWGWLTgQnKtmEJkAET7GcHvBvNQFVb/view?usp=drive_link" target="_blank" onclick="event.stopPropagation();">
    Whitepaperâ†— 
  </a>
      </div>
      <div class="card">
        <div class="icon">ğŸš€</div>
        <h2>Pettynomicsâ„¢</h2>
        <p>69% to the community, 15% therapy fund, 10% revenge marketing, 6% burned in ritual fire.</p>
      </div>
      <div class="card">
        <div class="icon">ğŸ”¥</div>
        <h2>Roadmap</h2>
        <p>Q1: Got dumped. Q2: Launched FMEX. Q3: Emotional detox. Q4: Moon!</p>
      </div>
    </section>

    <section class="buy-form">
 <div class="fmex-card-glow">
  <h2>ğŸ’” Join <span class="highlight">$FMEX</span> Presale Now</h2>
  <p>ğŸš€ Listing <strong>July 10th</strong> </p>
  <div class="down-arrow">â†“</div>
  </div>
  <div class="presale-announce">
  <p class="fade-in punchline">You gave your ex years... give us 1 SOL</p>
  <p class="fade-in delay-1 price-info">Presale Price: <strong>$0.00018</strong> | Listing: <strong>$0.0025</strong></p>
  <p class="fade-in delay-2 countdown-line" id="countdown" style="font-size: 0.85rem;"></p>
</div>
    <input type="number" id="solAmount" placeholder="Enter SOL amount (minimum 1)" min="1" step="0.2" />
    <p id="fmexEstimate" style="margin-top: 0.5rem; font-weight: bold;"></p>
    <button id="buyButton" class="btn primary">Buy with SOLANA</button>

    <!-- ğŸ’¸ Solana Pay Option -->
    <p class="solana-pay-text">Donâ€™t feel like connecting your wallet? Use <span class="solana-highlight">Solana Pay</span>!</p>
    <button id="solanaPayButton" class="btn secondary">ğŸŸ£ Buy $FMEX with Solana Pay</button>

    <div id="qr-container" style="margin-top:1rem; display:none; text-align:center;">
      <p style="color:white; margin-bottom:0.5rem;">Scan QR with Phantom or any Solana wallet:</p>
      <div id="solana-qr" style="display:inline-block;"></div>
      <p><a id="solana-link" href="#" target="_blank" style="color:#00e599;">Or click to pay via Solana Pay â†—</a></p>
    </div>

    <p id="confirmationMessage" style="margin-top:1rem;"></p>
  </section>

    

    <div class="progress-wrapper">
  <div class="progress-bar">
    <div class="progress-fill" id="progress-fill"></div>
  </div>
  <p class="progress-stats">Target: $50,000 | Raised: $10,980.01</p>
 </div>

    <footer>
  <p>â€œBecause sometimes the only way to healâ€¦ is to pump so hard your ex hears about it on Crypto Twitter.â€</p>

  <div class="socials">
    <a href="https://t.me/fmextoken" target="_blank" aria-label="Telegram">
      <img src="assets/telegram.svg" alt="Telegram icon" />
    </a>
    <a href="https://x.com/fuckmyexcoin" target="_blank" aria-label="X">
      <img src="assets/x.svg" alt="X icon" />
    </a>
    <a href="https://instagram.com/fuckmyexcoin" target="_blank" aria-label="Instagram">
      <img src="assets/instagram.svg" alt="Instagram icon" />
    </a>
  </div>
</footer>


  <script>
    // â³ Countdown Timer
  window.addEventListener('DOMContentLoaded', () => {
    const countdownEl = document.getElementById('countdown');
    const presaleEnd = new Date('2025-07-05T09:00:00');

    function updateCountdown() {
      const now = new Date().getTime();
      const distance = presaleEnd - now;

      if (distance < 0) {
        countdownEl.textContent = "ğŸš¨ Presale ended!";
        return;
      }

      const days = Math.floor(distance / (1000 * 60 * 60 * 24));
      const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
      const mins = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
      const secs = Math.floor((distance % (1000 * 60)) / 1000);

      countdownEl.textContent = `Presale ends in ${days}d ${hours}h ${mins}m ${secs}sâ³`;
    }

    updateCountdown();
    setInterval(updateCountdown, 1000);
  });
</script>



<script>
  function isMobile() {
    return /Mobi|Android|iPhone/i.test(navigator.userAgent);
  }

  window.addEventListener("DOMContentLoaded", () => {
    const phantomHint = document.getElementById("phantom-mobile-hint");

    if (isMobile() && (!window.solana || !window.solana.isPhantom)) {
      phantomHint.style.display = "block";
    }
  });
</script>

<script>
  const musicBtn = document.getElementById("music-toggle");
  const bgMusic = document.getElementById("bg-music");
  let isPlaying = false;

  musicBtn.addEventListener("click", () => {
    if (isPlaying) {
      bgMusic.pause();
      musicBtn.textContent = "ğŸµ";
    } else {
      bgMusic.volume = 0.4;
      bgMusic.play().catch(err => console.warn("Playback failed:", err));
      musicBtn.textContent = "ğŸ”‡";
    }
    isPlaying = !isPlaying;
  });
</script>

<script src="script.js"></script>

<script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>

<script type="module">
import { Transaction } from "https://esm.sh/@solana/web3.js";
import { Buffer } from "https://esm.sh/buffer@6.0.3";
import { createQR } from "https://esm.sh/@solana/pay";
import QRCode from "https://cdn.skypack.dev/qrcode";

window.Buffer = Buffer;

document.addEventListener("DOMContentLoaded", () => {
  const buyButton = document.getElementById("buyButton");
  const solanaPayBtn = document.getElementById("solanaPayButton");
  const solInput = document.getElementById("solAmount");
  const confirmMsg = document.getElementById("confirmationMessage");
  const qrCanvas = document.getElementById("solana-qr");
  const qrContainer = document.getElementById("qr-container");
  const solanaLink = document.getElementById("solana-link");
  const recipientAddress = "dev6vRg6EibnNDcrp6UGGgujvdnoVF6TexwruykPqo1";

  function showToast(message, isError = false, playSound = false) {
    const toast = document.getElementById("toast");
    toast.textContent = message;
    toast.style.background = isError ? "#b00020" : "#222";
    toast.classList.add("show");
    if (playSound) {
      const sound = document.getElementById("toast-sound");
      sound.currentTime = 0;
      sound.play().catch(() => {});
    }
    setTimeout(() => toast.classList.remove("show"), 5000);
  }

  solanaPayBtn.addEventListener("click", async () => {
  const amount = parseFloat(solInput.value);
  if (isNaN(amount) || amount < 1) {
    showToast("âš ï¸ Enter at least 1 SOL to use Solana Pay", true);
    return;
  }

  try {
    const response = await fetch("/.netlify/functions/solanaPayURL", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ amount })
    });

    const { url } = await response.json();
    if (!url) throw new Error("No URL returned from backend");

    // âœ… Use Phantom deep link
    const phantomDeepLink = `solana:${encodeURIComponent(url.toString())}`;
    solanaLink.href = phantomDeepLink;

    // âœ… Show animated QR container
    qrCanvas.innerHTML = "";
    const canvas = document.createElement("canvas");
    await QRCode.toCanvas(canvas, url, { width: 300 });
    qrCanvas.appendChild(canvas);

    qrContainer.style.display = "block";
    qrContainer.style.opacity = 0;
    qrContainer.style.transition = "opacity 0.5s ease";
    requestAnimationFrame(() => {
      qrContainer.style.opacity = 1;
    });

    showToast("ğŸ’˜ Scan QR or tap the link to pay with Phantom", false, true);
  } catch (err) {
    console.error(err);
    showToast("âŒ " + err.message, true);
  }
});

  buyButton.addEventListener("click", async () => {
    try {
      if (!window.solana?.isPhantom) {
        window.location.href = "https://phantom.app/ul/browse/" + encodeURIComponent(location.href);
        return;
      }

      const amount = parseFloat(solInput.value);
      if (isNaN(amount) || amount < 1) {
        showToast("âš ï¸ Enter at least 1 SOL", true);
        return;
      }

      buyButton.disabled = true;
      buyButton.textContent = "â³ Processing...";

      const provider = window.solana;
      await provider.connect();

      const txResp = await fetch("/.netlify/functions/createTransaction", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          from: provider.publicKey.toString(),
          to: recipientAddress,
          amount,
        }),
      });

      const txData = await txResp.json();
      if (!txData.transaction) throw new Error("Transaction creation failed");

      const transaction = Transaction.from(Buffer.from(txData.transaction, "base64"));
      const signed = await provider.signTransaction(transaction);

      const broadcastResp = await fetch("/.netlify/functions/broadcast", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          signedTxBase64: Buffer.from(signed.serialize()).toString("base64"),
        }),
      });

      const { signature, error } = await broadcastResp.json();
      if (error) throw new Error(error);

      confirmMsg.textContent = `âœ… Bought ${amount} SOL of $FMEX. Txn: ${signature}`;
      confirmMsg.style.color = "lime";
      showToast("âœ… Transaction complete", false, true);

    } catch (err) {
      console.error(err);
      showToast("âŒ " + err.message, true);
      confirmMsg.textContent = "âŒ " + err.message;
      confirmMsg.style.color = "red";
    } finally {
      buyButton.disabled = false;
      buyButton.textContent = "Buy with SOLANA";
    }
  });
});
</script>

</body>
</html>
